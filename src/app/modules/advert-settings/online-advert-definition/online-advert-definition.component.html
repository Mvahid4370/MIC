<!-- pop up messages -->
<p-toast key="advertismentTypeDefinition" position="bottom-left"></p-toast>

<!-- data table -->
<section class="section">
  <!-- <div class="card">
    <div class="card-body"> -->
  <div class="card-text pt-3"></div>
  <!-- input group -->
  <div class="pb-2">
    <p-panel class="search-panel__secation pb-1" header="تعریف اطلاعیه برخط">
      <form #formDir="ngForm" [formGroup]="onlineAdvertDefinitionForm">
        <div class="row">
          <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <label for="advertisementTypeId">نوع اطلاعیه</label>
            <p-treeSelect
              id="advertisementTypeId"
              class="md:w-20rem w-full"
              containerStyleClass="w-full"
              formControlName="advertisementTypeId"
              placeholder="انتخاب کنید"
              [options]="nodes"
              [filter]="true"
              [filterInputAutoFocus]="true"
              (onNodeSelect)="onNodeSelect()"
              [showClear]="true">
              [class.ng-invalid]="advertisementTypeId?.invalid"
              [class.ng-dirty]=" (addNewPersonFormSubmitted &&
              advertisementTypeId?.pristine) || advertisementTypeId?.dirty ||
              advertisementTypeId?.touched "</p-treeSelect
            >
            <div id="advertisementTypeId-help">
              <small
                *ngIf="(onlineAdvertDefinitionFormSubmitted && advertisementTypeId?.pristine) || 
                  (advertisementTypeId?.errors?.['required'] && (advertisementTypeId?.dirty || advertisementTypeId?.touched))"
                class="p-error">
                لطفا این فیلد را خالی نگذارید
              </small>
              <small style="visibility: hidden" class="p-error"> error </small>
            </div>
          </div>
          <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
            <label for="activeDate">تاریخ فعال سازی</label>
            <p-persian-calendar
              id="activeDate"
              name="activeDate"
              formControlName="activeDate"
              styleClass="w-100 ">
              [class.ng-invalid]="activeDate?.invalid" [class.ng-dirty]="
              (addNewPersonFormSubmitted && activeDate?.pristine) ||
              activeDate?.dirty || activeDate?.touched "
            </p-persian-calendar>
            <div id="activeDate-help">
              <small
                *ngIf="(onlineAdvertDefinitionFormSubmitted && activeDate?.pristine) || 
                (activeDate?.errors?.['required'] && (activeDate?.dirty || activeDate?.touched))"
                class="p-error">
                لطفا این فیلد را خالی نگذارید
              </small>
              <small style="visibility: hidden" class="p-error"> error </small>
            </div>
          </div>
          <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
            <label for="expiredDate">تاریخ انقضا</label>
            <p-persian-calendar
              id="expiredDate"
              name="expiredDate"
              formControlName="expiredDate"
              styleClass="w-100 ">
              [class.ng-invalid]="expiredDate?.invalid" [class.ng-dirty]="
              (addNewPersonFormSubmitted && expiredDate?.pristine) ||
              expiredDate?.dirty || expiredDate?.touched "
            </p-persian-calendar>
            <div id="expiredDate-help">
              <small
                *ngIf="(onlineAdvertDefinitionFormSubmitted && expiredDate?.pristine) || 
                (expiredDate?.errors?.['required'] && (expiredDate?.dirty || expiredDate?.touched))"
                class="p-error">
                لطفا این فیلد را خالی نگذارید
              </small>
              <small style="visibility: hidden" class="p-error"> error </small>
            </div>
          </div>
          <!-- <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12 div-isActive">
            <label for="isActive">فعال بودن</label>
            <p-checkbox
              id="isActive"
              name="isActive"
              formControlName="isActive"
              [binary]="true"
              inputId="binary">
              [class.ng-invalid]="isActive?.invalid" [class.ng-dirty]="
              (addNewPersonFormSubmitted && isActive?.pristine) || isActive?.dirty
              || isActive?.touched "</p-checkbox
            >
            <div id="isActive-help">
              <small
                *ngIf="(onlineAdvertDefinitionFormSubmitted && isActive?.pristine) || 
                (isActive?.errors?.['required'] && (isActive?.dirty || isActive?.touched))"
                class="p-error">
                لطفا این فیلد را خالی نگذارید
              </small>
              <small style="visibility: hidden" class="p-error"> error </small>
            </div>
          </div> -->
          <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
            <label for="description">توضیحات</label>
            <input
              pInputText
              id="description"
              name="description"
              formControlName="description"
              type="text"
              class="w-100"
              [class.ng-invalid]="description?.invalid"
              [class.ng-dirty]="
                (onlineAdvertDefinitionFormSubmitted &&
                  description?.pristine) ||
                description?.dirty ||
                description?.touched
              " />

            <div id="description-help">
              <small
                *ngIf="(onlineAdvertDefinitionFormSubmitted && description?.pristine) || 
            (description?.errors?.['required'] && (description?.dirty || description?.touched))"
                class="p-error">
                لطفا این فیلد را خالی نگذارید
              </small>
              <small style="visibility: hidden" class="p-error"> error </small>
            </div>
          </div>
          <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
            <label for="increaseValueScore">امتیاز مثبت ارسال به موقع</label>
            <p-inputNumber
              mode="decimal"
              inputId="withoutgrouping"
              [useGrouping]="false"
              id="increaseValueScore"
              name="increaseValueScore"
              formControlName="increaseValueScore">
              [class.ng-invalid]="increaseValueScore?.invalid"
              [class.ng-dirty]=" (addNewPersonFormSubmitted &&
              increaseValueScore?.pristine) || increaseValueScore?.dirty ||
              increaseValueScore?.touched "</p-inputNumber
            >
            <div id="increaseValueScore-help">
              <small
                *ngIf="(onlineAdvertDefinitionFormSubmitted && increaseValueScore?.pristine) || 
                (increaseValueScore?.errors?.['required'] && (increaseValueScore?.dirty || increaseValueScore?.touched))"
                class="p-error">
                لطفا این فیلد را خالی نگذارید
              </small>
              <small style="visibility: hidden" class="p-error"> error </small>
            </div>
          </div>
          <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
            <label for="decreaseValueScore">امتیاز منفی تاخیر ارسال</label>
            <p-inputNumber
              mode="decimal"
              inputId="withoutgrouping"
              [useGrouping]="false"
              id="decreaseValueScore"
              name="decreaseValueScore"
              formControlName="decreaseValueScore">
              [class.ng-invalid]="decreaseValueScore?.invalid"
              [class.ng-dirty]=" (addNewPersonFormSubmitted &&
              decreaseValueScore?.pristine) || decreaseValueScore?.dirty ||
              decreaseValueScore?.touched "</p-inputNumber
            >
            <div id="decreaseValueScore-help">
              <small
                *ngIf="(onlineAdvertDefinitionFormSubmitted && decreaseValueScore?.pristine) || 
                (decreaseValueScore?.errors?.['required'] && (decreaseValueScore?.dirty || decreaseValueScore?.touched))"
                class="p-error">
                لطفا این فیلد را خالی نگذارید
              </small>
              <small style="visibility: hidden" class="p-error"> error </small>
            </div>
          </div>
        </div>
      </form>
    </p-panel>
  </div>
  <p-table
    #dataTable
    class="data-table"
    dataKey="id"
    editMode="row"
    [paginator]="true"
    [rows]="dataTableRows"
    [rowsPerPageOptions]="[10, 20, 30]"
    [styleClass]="gridClass"
    [rowHover]="true"
    [value]="needs"
    [loading]="loading"
    [responsive]="true"
    [tableStyle]="{ 'min-width': '75rem' }">
    <ng-template pTemplate="header">
      <tr class="data-table__header">
        <th>
          <strong>نوع فایل پیوست</strong>
        </th>
        <th>
          <strong> عنوان </strong>
        </th>
        <th>
          <strong> اجباری بودن </strong>
        </th>
        <th>
          <strong> سال </strong>
        </th>
        <th>
          <strong> ماه </strong>
        </th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-need
      let-editing="editing"
      let-ri="rowIndex">
      <tr [pEditableRow]="need">
        <td>{{ need.attachmentFileTypeName }}</td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" [(ngModel)]="need.title" required />
            </ng-template>
            <ng-template pTemplate="output">
              {{ need.title }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-checkbox
                [(ngModel)]="need.isRequired"
                [binary]="true"
                inputId="binary"></p-checkbox>
            </ng-template>
            <ng-template pTemplate="output">
              <i *ngIf="need.isRequired" class="pi pi-check-square"></i>
              <i *ngIf="!need.isRequired" class="pi pi-times-circle"></i>
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-inputNumber
                mode="decimal"
                inputId="withoutgrouping"
                [useGrouping]="false"
                [(ngModel)]="need.year">
              </p-inputNumber>
            </ng-template>
            <ng-template pTemplate="output">
              {{ need.year }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <p-inputNumber
                mode="decimal"
                inputId="withoutgrouping"
                [useGrouping]="false"
                [(ngModel)]="need.month">
              </p-inputNumber>
            </ng-template>
            <ng-template pTemplate="output">
              {{ need.month }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <div class="flex align-items-center justify-content-center gap-2">
            <button
              *ngIf="!editing"
              pButton
              pRipple
              type="button"
              pInitEditableRow
              icon="pi pi-pencil"
              (click)="onRowEditInit(need)"
              class="p-button-rounded p-button-text"></button>
            <button
              *ngIf="editing"
              pButton
              pRipple
              type="button"
              pSaveEditableRow
              icon="pi pi-check"
              class="p-button-rounded p-button-text p-button-success mr-2"></button>
            <button
              *ngIf="editing"
              pButton
              pRipple
              type="button"
              pCancelEditableRow
              icon="pi pi-times"
              (click)="onRowEditCancel(need, ri)"
              class="p-button-rounded p-button-text p-button-danger"></button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-button
    class="pe-2 p-button-wide submit-btn"
    styleClass="p-button-success"
    label="ثبت"
    icon="pi pi-check"
    (click)="onSubmit()"
    [loading]="onlineAdvertDefinitionFormLoading"></p-button>
</section>
